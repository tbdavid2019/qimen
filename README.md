# å¥‡é–€éç”²æ’ç›¤ç³»çµ±

ä¸€å€‹åŸºæ–¼ Node.js çš„å¥‡é–€éç”²æ’ç›¤ç³»çµ±ï¼Œéµå¾ªèŒ…å±±æ´¾å¥‡é–€éç”²æ’ç›¤æ–¹æ³•ï¼Œæ”¯æ´ç¹ç°¡é«”ä¸­æ–‡å’Œ AI æ™ºèƒ½è§£ç›¤åŠŸèƒ½ã€‚

æ˜¯å…ˆæƒ³å¥½å•é¡Œ å†é–‹ç¶²é 
https://qi.david888.com
![alt text](image.png)

**è‡´è¬åŸä½œè€…**ï¼šæœ¬å°ˆæ¡ˆåŸºæ–¼ [qfdk/qimen](https://github.com/qfdk/qimen) é€²è¡Œé–‹ç™¼å’Œæ”¹é€²ã€‚

## åŠŸèƒ½ç‰¹é»

### ğŸ”® æ ¸å¿ƒåŠŸèƒ½
- **å¯¦æ™‚æ’ç›¤**ï¼šæ ¹æ“šç•¶å‰æ™‚é–“è‡ªå‹•è¨ˆç®—å¥‡é–€ç›¤
- **è‡ªå®šç¾©æ’ç›¤**ï¼šå¯é¸æ“‡ä»»æ„æ—¥æœŸæ™‚é–“é€²è¡Œå¥‡é–€æ’ç›¤
- **å¤šç¨®æ’ç›¤æ–¹æ³•**ï¼šæ”¯æ´æ™‚å®¶ã€æ—¥å®¶ã€æœˆå®¶ã€å¹´å®¶å¥‡é–€
- **å¤šç”¨é€”åˆ†æ**ï¼šç¶œåˆã€äº‹æ¥­ã€è²¡é‹ã€æ„Ÿæƒ…ã€å¥åº·ç­‰ä¸åŒç”¨é€”
- **æ™‚é–“ç²¾åº¦æ¨¡å¼**ï¼š
  - **å‚³çµ±æ¨¡å¼**ï¼šä»¥ç•¶ä¸‹æ™‚è¾°èµ·ç›¤ï¼ˆå…©å°æ™‚ä¸€ç›¤ï¼‰
  - **é€²éšæ¨¡å¼**ï¼šä¹å®®æ‹†è£œï¼ˆ13åˆ†é˜æ³•ï¼‰ï¼Œæ¯æ™‚è¾°ç´°åˆ†ç‚º9æ®µ

### ğŸŒ¸ æ¢…èŠ±æ˜“æ•¸
- **æ™‚é–“èµ·å¦**ï¼šæ¡ç”¨å‚³çµ±æ™‚è¾°ï¼ˆå­æ™‚ 23:00â€“00:59 èµ·ç®—ï¼‰
- **å¦è±¡çµæœ**ï¼šæœ¬å¦ã€äº’å¦ã€è®Šå¦èˆ‡é«”ç”¨äº”è¡Œåˆ†æ
- **å¦è¾­/çˆ»è¾­**ï¼šå®Œæ•´ 64 å¦èˆ‡ 384 çˆ»è³‡æ–™
- **AI è§£å¦**ï¼šæ”¯æ´æ¢…èŠ±æ˜“æ•¸çš„ AI åˆ†æèˆ‡å¤–éƒ¨ API å•ç­”

### ğŸ¤– AI æ™ºèƒ½è§£ç›¤
- **AI å¤§å¸«è§£ç›¤**ï¼šä½¿ç”¨å¤§èªè¨€æ¨¡å‹é€²è¡Œæ™ºèƒ½è§£è®€
- **äº’å‹•å•ç­”**ï¼šé‡å°æ’ç›¤çµæœæå‡ºå…·é«”å•é¡Œ
- **çºŒå•åŠŸèƒ½**ï¼šæ”¯æ´å¤šè¼ªå°è©±ï¼ŒAI æœƒè¨˜ä½å°è©±è„ˆçµ¡ï¼Œå¯æ·±å…¥è¿½å•ç´°ç¯€
- **æ¸…é™¤å°è©±**ï¼šä¸€éµæ¸…é™¤å°è©±è¨˜éŒ„ï¼Œé–‹å§‹æ–°çš„å•é¡Œ
- **å¤šæ¨¡å‹æ”¯æ´**ï¼šæ”¯æ´ OpenAIã€Claudeã€Groqã€é€šç¾©åƒå•ã€æœ¬åœ° Ollama ç­‰ [æ›´è©³ç´°èªªæ˜](LLM-INTEGRATION.md)
- **å€‹æ€§åŒ–åˆ†æ**ï¼šæ ¹æ“šä¸åŒç”¨é€”æä¾›å°ˆé–€å»ºè­°

### ğŸŒ å¤šèªè¨€æ”¯æ´
- **ç¹é«”ä¸­æ–‡**ï¼ˆé è¨­ï¼‰
- **ç°¡é«”ä¸­æ–‡**
- **èªè¨€åˆ‡æ›**ï¼šä¸€éµåˆ‡æ›ä»‹é¢èªè¨€

### ğŸ“Š å®Œæ•´ä¿¡æ¯å±•ç¤º
- **åŸºæœ¬è³‡è¨Š**ï¼šå±€æ•¸ï¼ˆé™°é™½éã€ä¸Šä¸­ä¸‹å…ƒï¼‰ã€å››æŸ±ã€æ—¬é¦–
- **ä¹å®®åˆ†æ**ï¼šå…«é–€ã€ä¹æ˜Ÿã€å…«ç¥åˆ†å¸ƒ
- **åœ°ç›¤è³‡è¨Š**ï¼šåœ°æ”¯ã€ä¸‰å¥‡å…­å„€
- **å€¼ç¬¦å€¼ä½¿**ï¼šè©³ç´°ä½ç½®å’Œå½±éŸ¿åˆ†æ
- **å‰å‡¶åˆ¤æ–·**ï¼šå„å®®ä½å‰å‡¶æ¨™è¨˜å’Œè©³ç´°èªªæ˜

### ğŸ¨ ç”¨æˆ¶é«”é©—
- **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šé©é…æ¡Œé¢å’Œæ‰‹æ©Ÿè¨­å‚™
- **ç›´è§€ç•Œé¢**ï¼šåœ–å½¢åŒ–ä¹å®®æ ¼é¡¯ç¤º
- **é¡è‰²æ¨™è¨˜**ï¼šäº”è¡Œé¡è‰²å’Œå‰å‡¶æ¨™ç¤º
- **è©³ç´°èªªæ˜**ï¼šåŒ…å«å¥‡é–€éç”²åŸºç¤çŸ¥è­˜

## å®‰è£ä½¿ç”¨

### ç’°å¢ƒè¦æ±‚
- Node.js 14+ 
- pnpm æˆ– npm

### å¿«é€Ÿé–‹å§‹
```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd qimen

# å®‰è£ä¾è³´
pnpm install

# é…ç½®ç’°å¢ƒè®Šæ•¸ï¼ˆå¯é¸ï¼Œç”¨æ–¼ AI åŠŸèƒ½ï¼‰
cp .env.example .env
# ç·¨è¼¯ .env æ–‡ä»¶ï¼Œè¨­ç½® LLM API Key

# å•Ÿå‹•æ‡‰ç”¨
pnpm start
# æˆ–
node app.js

# è¨ªå•æ‡‰ç”¨
# æ‰“é–‹ç€è¦½å™¨è¨ªå• http://localhost:3000
```

### AI åŠŸèƒ½é…ç½®

#### OpenAI é…ç½®
```env
LLM_PROVIDER=openai
LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=gpt-4o-mini
```

#### æœ¬åœ° Ollama é…ç½®ï¼ˆå…è²»ï¼‰
```env
LLM_PROVIDER=ollama
LLM_API_KEY=not_required
LLM_MODEL=llama3.1:latest
LLM_BASE_URL=http://localhost:11434/v1
```

#### Groq é…ç½®ï¼ˆé«˜é€Ÿæ¨ç†ï¼‰

```env
LLM_PROVIDER=groq
LLM_API_KEY=gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=mixtral-8x7b-32768
```

#### Discord Webhook é…ç½®ï¼ˆå¯é¸ï¼‰
```env
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN
```

## æŠ€è¡“æ¶æ§‹

### å¾Œç«¯æŠ€è¡“
- **Express.js**ï¼šWeb æ¡†æ¶
- **lunar-javascript**ï¼šè¾²æ›†å’Œç¯€æ°£è¨ˆç®—
- **EJS**ï¼šæ¨¡æ¿å¼•æ“
- **å¤šèªè¨€æ”¯æ´**ï¼šè‡ªå»º i18n ç³»çµ±

### AI æ•´åˆ
- **LLM æœå‹™**ï¼šçµ±ä¸€çš„å¤šæä¾›å•†æ¥å£
- **æ™ºèƒ½æç¤ºè©**ï¼šçµæ§‹åŒ–å¥‡é–€æ•¸æ“šè½‰æ›
- **éŒ¯èª¤è™•ç†**ï¼šå„ªé›…é™ç´šå’Œå‚™ç”¨åˆ†æ

### å‰ç«¯æŠ€è¡“
- **Bootstrap**ï¼šéŸ¿æ‡‰å¼ UI æ¡†æ¶
- **jQuery**ï¼šDOM æ“ä½œå’Œ AJAX
- **CSS3**ï¼šç¾ä»£æ¨£å¼å’Œå‹•ç•«

## API æ¥å£

### Web ç•Œé¢
- `GET /`ï¼šä¸»é é¢ï¼ˆå¯¦æ™‚æ’ç›¤ï¼‰
- `GET /custom`ï¼šè‡ªå®šç¾©æ’ç›¤
- `GET /start`ï¼šéœå¿ƒèµ·ç›¤é é¢
- `GET /meihua`ï¼šæ¢…èŠ±æ˜“æ•¸èµ·å¦é é¢

### LLM AI åˆ†æ
- `POST /api/llm-analysis`ï¼šAI è§£ç›¤åˆ†æï¼ˆæ”¯æ´ `conversationHistory` åƒæ•¸é€²è¡Œå¤šè¼ªå°è©±ï¼‰
- `POST /api/meihua/llm-analysis`ï¼šæ¢…èŠ±æ˜“æ•¸ AI è§£å¦
- `GET /api/llm-config`ï¼šLLM é…ç½®ç‹€æ…‹
- `GET /api/llm-test`ï¼šæ¸¬è©¦ LLM é€£æ¥

### å¤–éƒ¨ API èª¿ç”¨
- `POST /api/qimen-question`ï¼š**å¥‡é–€å•ç­” API**ï¼ˆä¾›å¤–éƒ¨ç³»çµ±èª¿ç”¨ï¼‰
- `POST /api/meihua-question`ï¼š**æ¢…èŠ±æ˜“æ•¸å•ç­” API**ï¼ˆä¾›å¤–éƒ¨ç³»çµ±èª¿ç”¨ï¼‰

### Discord æ•´åˆ
- `GET /api/discord-test`ï¼šDiscord webhook æ¸¬è©¦

### å…¶ä»–
- `GET /api/qimen`ï¼šå¥‡é–€æ’ç›¤æ•¸æ“šæŸ¥è©¢
- `POST /api/meihua/qigua`ï¼šæ¢…èŠ±æ˜“æ•¸èµ·å¦
- `GET /api/timezone-debug`ï¼šæ™‚å€èª¿è©¦ä¿¡æ¯

---

## ğŸš€ å¤–éƒ¨ API èª¿ç”¨ (v2.0 æ–°åŠŸèƒ½)

ç¾åœ¨æ‚¨å¯ä»¥é€šé API ç›´æ¥èª¿ç”¨å¥‡é–€å•ç­”åŠŸèƒ½ï¼Œç„¡éœ€æ‰“é–‹ç¶²é ç•Œé¢ï¼

### API ç«¯é»
```
POST /api/qimen-question
```

### è«‹æ±‚æ ¼å¼
```json
{
  "question": "ä»Šå¤©é©åˆæŠ•è³‡å—ï¼Ÿ",
  "datetime": "2024-01-01T10:30:00",  // å¯é¸ï¼Œé è¨­ç•¶å‰æ™‚é–“
  "timezone": "+08:00",               // å¯é¸ï¼Œé è¨­ç³»çµ±æ™‚å€
  "mode": "advanced",                 // å¯é¸ï¼štraditional/advanced
  "purpose": "äº‹æ¥­"                   // å¯é¸ï¼šç¶œåˆ/äº‹æ¥­/æ„Ÿæƒ…/è²¡é‹ç­‰
}
```

### å›æ‡‰æ ¼å¼
```json
{
  "success": true,
  "answer": "æ ¹æ“šç•¶å‰å¥‡é–€ç›¤åˆ†æï¼Œä»Šæ—¥åºšé‡‘è‡¨éœ‡å®®...",
  "qimenInfo": {
    "datetime": "2024-01-01T10:30:00.000Z",
    "localDate": "2024/1/1",
    "localTime": "ä¸Šåˆ10:30:00",
    "mode": "advanced",
    "purpose": "äº‹æ¥­"
  },
  "provider": "openai",
  "model": "gpt-4o-mini",
  "timestamp": "2024-01-01T10:30:15.123Z",
  "discordSent": true
}
```

### ä½¿ç”¨ç¯„ä¾‹

#### cURL èª¿ç”¨
```bash
curl -X POST http://localhost:3000/api/qimen-question \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ä»Šå¤©é©åˆæŠ•è³‡å—ï¼Ÿ",
    "mode": "advanced",
    "purpose": "è²¡é‹"
  }'
```

---

## ğŸŒ¸ æ¢…èŠ±æ˜“æ•¸å¤–éƒ¨ API

### API ç«¯é»
```
POST /api/meihua-question
```

### è«‹æ±‚æ ¼å¼
```json
{
  "question": "ä»Šå¤©é©åˆç°½ç´„å—ï¼Ÿ",
  "method": "time",
  "datetime": "2026-01-20T15:30:00",
  "timezone": "+08:00"
}
```

### æ¬„ä½èªªæ˜
- `question`ï¼šå¿…å¡«ï¼Œä½¿ç”¨è€…å•é¡Œ
- `method`ï¼š`time`ï¼ˆæ™‚é–“èµ·å¦ï¼‰æˆ– `numbers`ï¼ˆæ•¸å­—èµ·å¦ï¼‰
- `datetime`ï¼šå¯é¸ï¼Œæ™‚é–“èµ·å¦çš„æŒ‡å®šæ™‚é–“ï¼ˆISO æ ¼å¼ï¼‰ï¼Œé è¨­ç‚ºç¾åœ¨
- `timezone`ï¼šå¯é¸ï¼Œæ™‚å€åç§»ï¼Œé è¨­ç‚ºç³»çµ±æ™‚å€ï¼ˆä¾‹å¦‚ `+08:00`ï¼‰
- `num1`ã€`num2`ã€`num3`ï¼šæ•¸å­—èµ·å¦ç”¨ï¼ˆ`method=numbers`ï¼‰

### cURL èª¿ç”¨
```bash
curl -X POST http://localhost:3000/api/meihua-question \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ä»Šå¤©é©åˆç°½ç´„å—ï¼Ÿ",
    "method": "time",
    "datetime": "2026-01-20T15:30:00",
    "timezone": "+08:00"
  }'
```

#### æ•¸å­—èµ·å¦ç¯„ä¾‹
```bash
curl -X POST http://localhost:3000/api/meihua-question \
  -H "Content-Type: application/json" \
  -d '{
    "question": "é€™å€‹åˆä½œæ¡ˆçš„çµæœå¦‚ä½•ï¼Ÿ",
    "method": "numbers",
    "num1": 6,
    "num2": 8,
    "num3": 3
  }'
```

#### JavaScript èª¿ç”¨
```javascript
const response = await fetch('http://localhost:3000/api/qimen-question', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    question: 'ä»Šå¤©é©åˆæŠ•è³‡å—ï¼Ÿ',
    mode: 'advanced',
    purpose: 'è²¡é‹'
  })
});

const result = await response.json();
console.log(result.answer);
```

#### Python èª¿ç”¨
```python
import requests

response = requests.post('http://localhost:3000/api/qimen-question', 
  json={
    'question': 'ä»Šå¤©é©åˆæŠ•è³‡å—ï¼Ÿ',
    'mode': 'advanced', 
    'purpose': 'è²¡é‹'
  }
)

result = response.json()
print(result['answer'])
```

### æ‡‰ç”¨å ´æ™¯
- **èŠå¤©æ©Ÿå™¨äºº**ï¼šLine Botã€Discord Botã€Telegram Bot
- **ç¬¬ä¸‰æ–¹æ•´åˆ**ï¼šå…¶ä»–å åœç¶²ç«™ã€æ‡‰ç”¨ç¨‹å¼
- **è‡ªå‹•åŒ–æŸ¥è©¢**ï¼šå®šæ™‚ç²å–æ¯æ—¥é‹å‹¢
- **æ‰¹é‡åˆ†æ**ï¼šç ”ç©¶ä¸åŒæ™‚é–“é»çš„é‹å‹¢è®ŠåŒ–

---

## ğŸ’¬ çºŒå•åŠŸèƒ½èªªæ˜

AI å•ç­”æ”¯æ´å¤šè¼ªå°è©±ï¼Œè®“æ‚¨å¯ä»¥æ·±å…¥è¿½å•ç´°ç¯€ï¼š

### ä½¿ç”¨æ–¹å¼
1. è¼¸å…¥ç¬¬ä¸€å€‹å•é¡Œï¼ŒAI å›ç­”å¾Œæœƒé¡¯ç¤ºåœ¨å°è©±å€åŸŸ
2. åœ¨è¼¸å…¥æ¡†ç¹¼çºŒè¼¸å…¥çºŒå•å•é¡Œï¼ŒAI æœƒè¨˜ä½ä¹‹å‰çš„å°è©±è„ˆçµ¡
3. é»æ“Š ğŸ—‘ï¸ æŒ‰éˆ•å¯æ¸…é™¤å°è©±è¨˜éŒ„ï¼Œé–‹å§‹æ–°çš„å•é¡Œ

### æŠ€è¡“ç´°ç¯€
- å°è©±æ­·å²å„²å­˜åœ¨ç€è¦½å™¨ç«¯ï¼ˆå‰ç«¯å„²å­˜ï¼‰
- æœ€å¤šä¿ç•™ 10 è¼ªå°è©±ï¼Œé¿å…è¶…é API token é™åˆ¶
- é‡æ–°æ•´ç†é é¢æœƒæ¸…ç©ºå°è©±è¨˜éŒ„

### API èª¿ç”¨çºŒå•
```javascript
// é€é conversationHistory åƒæ•¸å‚³éå°è©±æ­·å²
const response = await fetch('/api/llm-analysis', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    qimenData: qimenData,
    userQuestion: 'å¯ä»¥å†è©³ç´°èªªæ˜è²¡é‹éƒ¨åˆ†å—ï¼Ÿ',
    conversationHistory: [
      { role: 'user', content: 'ä»Šå¤©é‹å‹¢å¦‚ä½•ï¼Ÿ' },
      { role: 'assistant', content: 'AI çš„ç¬¬ä¸€å€‹å›ç­”...' }
    ],
    purpose: 'ç¶œåˆ',
    lang: 'zh-tw'
  })
});
```

---

## ğŸ”” Discord Webhook æ•´åˆ

ç³»çµ±æ”¯æ´ Discord Webhook æ•´åˆï¼Œå¯å°‡ç”¨æˆ¶å•é¡Œå’Œ AI è§£ç­”è‡ªå‹•ç™¼é€åˆ° Discord é »é“ã€‚

### é…ç½® Discord Webhook

1. åœ¨ Discord ä¼ºæœå™¨ä¸­å‰µå»º Webhookï¼š
   - é€²å…¥é »é“è¨­å®š â†’ æ•´åˆ â†’ Webhook
   - é»æ“Šã€Œæ–°å¢ Webhookã€
   - è¤‡è£½ Webhook URL

2. åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š
```env
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN
```

### Discord åŠŸèƒ½
- **ç”¨æˆ¶å•é¡Œé€šçŸ¥**ï¼šç•¶æœ‰äººåœ¨ç¶²é æˆ– API æå•æ™‚ï¼Œè‡ªå‹•ç™¼é€åˆ° Discord
- **AI è§£ç­”è¨˜éŒ„**ï¼šLLM çš„è§£ç›¤çµæœä¹Ÿæœƒç™¼é€åˆ° Discord
- **ä¾†æºæ¨™è¨˜**ï¼šå€åˆ†ä¾†è‡ªç¶²é ç•Œé¢æˆ–å¤–éƒ¨ API çš„è«‹æ±‚
- **æ ¼å¼åŒ–é¡¯ç¤º**ï¼šä½¿ç”¨ Discord Embed æ ¼å¼ï¼Œç¾è§€æ˜“è®€

### æ¸¬è©¦ Discord é€£æ¥
```bash
curl http://localhost:3000/api/discord-test
```

## å°ˆæ¡ˆçµæ§‹

```text
qimen/
â”œâ”€â”€ app.js                    # ä¸»æ‡‰ç”¨ç¨‹åº
â”œâ”€â”€ data/                     # è³‡æ–™æª”
â”‚   â””â”€â”€ meihua/yaoci.md       # æ¢…èŠ±æ˜“æ•¸å¦è¾­/çˆ»è¾­
â”œâ”€â”€ lib/                      # æ ¸å¿ƒåº«
â”‚   â”œâ”€â”€ qimen.js             # å¥‡é–€éç”²è¨ˆç®—å¼•æ“
â”‚   â”œâ”€â”€ meihua.js            # æ¢…èŠ±æ˜“æ•¸è¨ˆç®—å¼•æ“
â”‚   â”œâ”€â”€ meihua-text.js       # å¦è¾­/çˆ»è¾­è³‡æ–™è™•ç†
â”‚   â”œâ”€â”€ llm-analysis.js      # AI è§£ç›¤æœå‹™
â”‚   â”œâ”€â”€ discord-webhook.js   # Discord Webhook æ•´åˆ
â”‚   â”œâ”€â”€ api-time-handler.js  # API æ™‚é–“è™•ç†å·¥å…·
â”‚   â”œâ”€â”€ i18n.js              # å¤šèªè¨€ç³»çµ±
â”‚   â””â”€â”€ constants.js         # å¸¸é‡å®šç¾©
â”œâ”€â”€ views/                    # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ public/                   # éœæ…‹è³‡æº
â”œâ”€â”€ lang/                     # èªè¨€æ–‡ä»¶
â””â”€â”€ .env.example             # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹ï¼ˆå« Discord é…ç½®ï¼‰
```

---

# Qimen Dunjia Divination System

A Node.js-based Qimen Dunjia divination system following the Maoshan school methodology, with Traditional/Simplified Chinese support and AI-powered analysis.

**Credits**: This project is developed based on [qfdk/qimen](https://github.com/qfdk/qimen).

## Features

### ğŸ”® Core Functions
- **Real-time Divination**: Automatic calculation based on current time
- **Custom Divination**: Choose any date and time for divination
- **Multiple Methods**: Support for Shijia, Rijia, Yuejia, Nianjia Qimen
- **Multi-purpose Analysis**: General, career, wealth, love, health consultations

### ğŸŒ¸ Meihua Yishu
- **Time-based Qigua**: Uses traditional shichen ranges (Zi hour starts at 23:00)
- **Hexagram Results**: Ben Gua, Hu Gua, Bian Gua, and wuxing analysis
- **Full Text**: Complete 64 gua and 384 yao content
- **AI Reading**: LLM analysis and external API support

### ğŸ¤– AI-Powered Analysis
- **AI Master Reading**: Intelligent interpretation using Large Language Models
- **Interactive Q&A**: Ask specific questions about divination results
- **Multiple AI Models**: Support for OpenAI, Claude, Groq, Qwen, local Ollama
- **Personalized Analysis**: Tailored advice for different purposes

### ğŸŒ Multi-language Support
- **Traditional Chinese** (default)
- **Simplified Chinese**
- **Language Toggle**: One-click interface switching

### ğŸ“Š Comprehensive Display
- **Basic Info**: Bureau numbers, Four Pillars, Xun Shou
- **Nine Palaces**: Eight Gates, Nine Stars, Eight Spirits distribution
- **Earth Plate**: Earthly Branches, Three Wonders and Six Instruments
- **Zhifu Zhishi**: Detailed position and influence analysis
- **Fortune Assessment**: Palace-wise fortune marking and explanations

### ğŸ¨ User Experience
- **Responsive Design**: Desktop and mobile compatibility
- **Intuitive Interface**: Graphical nine-palace grid display
- **Color Coding**: Five-element colors and fortune indicators
- **Detailed Guide**: Qimen Dunjia fundamentals included

## Installation

### Requirements
- Node.js 14+
- pnpm or npm

### Quick Start
```bash
# Clone the project
git clone <repository-url>
cd qimen

# Install dependencies
pnpm install

# Configure environment (optional, for AI features)
cp .env.example .env
# Edit .env file to set LLM API Key

# Start the application
pnpm start
# or
node app.js

# Access the application
# Open browser and visit http://localhost:3000
```

### AI Configuration

#### OpenAI Setup
```env
LLM_PROVIDER=openai
LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=gpt-4o-mini
```

#### Local Ollama Setup (Free)
```env
LLM_PROVIDER=ollama
LLM_API_KEY=not_required
LLM_MODEL=llama3.1:latest
LLM_BASE_URL=http://localhost:11434/v1
```

#### Groq Setup (High-speed Inference)

```env
LLM_PROVIDER=groq
LLM_API_KEY=gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=mixtral-8x7b-32768
```

## Technical Stack

### Backend
- **Express.js**: Web framework
- **lunar-javascript**: Lunar calendar and solar terms calculation
- **EJS**: Template engine
- **i18n System**: Custom multilingual support

### AI Integration
- **LLM Service**: Unified multi-provider interface
- **Smart Prompts**: Structured Qimen data conversion
- **Error Handling**: Graceful fallback and backup analysis

### Frontend
- **Bootstrap**: Responsive UI framework
- **jQuery**: DOM manipulation and AJAX
- **CSS3**: Modern styling and animations

## API Endpoints

- `GET /`: Main page (real-time divination)
- `GET /custom`: Custom divination
- `POST /api/llm-analysis`: AI divination analysis
- `GET /api/llm-config`: LLM configuration status
- `GET /api/llm-test`: Test LLM connection

## Project Structure

```text
qimen/
â”œâ”€â”€ app.js                    # Main application
â”œâ”€â”€ lib/                      # Core libraries
â”‚   â”œâ”€â”€ qimen.js             # Qimen calculation engine
â”‚   â”œâ”€â”€ llm-analysis.js      # AI analysis service
â”‚   â”œâ”€â”€ discord-webhook.js   # Discord Webhook integration
â”‚   â”œâ”€â”€ api-time-handler.js  # API time handling utility
â”‚   â”œâ”€â”€ i18n.js              # Multilingual system
â”‚   â””â”€â”€ constants.js         # Constants definition
â”œâ”€â”€ views/                    # Template files
â”œâ”€â”€ public/                   # Static assets
â”œâ”€â”€ lang/                     # Language files
â””â”€â”€ .env.example             # Environment variables example (with Discord config)
```
