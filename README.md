# å¥‡é–€éç”²æ’ç›¤ç³»çµ±

ä¸€å€‹åŸºæ–¼ Node.js çš„å¥‡é–€éç”²æ’ç›¤ç³»çµ±ï¼Œéµå¾ªèŒ…å±±æ´¾å¥‡é–€éç”²æ’ç›¤æ–¹æ³•ï¼Œæ”¯æ´ç¹ç°¡é«”ä¸­æ–‡å’Œ AI æ™ºèƒ½è§£ç›¤åŠŸèƒ½ã€‚

æ˜¯å…ˆæƒ³å¥½å•é¡Œ å†é–‹ç¶²é 
https://qi.david888.com
![alt text](image.png)

**è‡´è¬åŸä½œè€…**ï¼šæœ¬å°ˆæ¡ˆåŸºæ–¼ [qfdk/qimen](https://github.com/qfdk/qimen) é€²è¡Œé–‹ç™¼å’Œæ”¹é€²ã€‚

## åŠŸèƒ½ç‰¹é»

### ğŸ”® æ ¸å¿ƒåŠŸèƒ½
- **å¯¦æ™‚æ’ç›¤**ï¼šæ ¹æ“šç•¶å‰æ™‚é–“è‡ªå‹•è¨ˆç®—å¥‡é–€ç›¤
- **è‡ªå®šç¾©æ’ç›¤**ï¼šå¯é¸æ“‡ä»»æ„æ—¥æœŸæ™‚é–“é€²è¡Œå¥‡é–€æ’ç›¤
- **å¤šç¨®æ’ç›¤æ–¹æ³•**ï¼šæ”¯æ´æ™‚å®¶ã€æ—¥å®¶ã€æœˆå®¶ã€å¹´å®¶å¥‡é–€
- **å¤šç”¨é€”åˆ†æ**ï¼šç¶œåˆã€äº‹æ¥­ã€è²¡é‹ã€æ„Ÿæƒ…ã€å¥åº·ç­‰ä¸åŒç”¨é€”
- **æ™‚é–“ç²¾åº¦æ¨¡å¼**ï¼š
  - **å‚³çµ±æ¨¡å¼**ï¼šä»¥ç•¶ä¸‹æ™‚è¾°èµ·ç›¤ï¼ˆå…©å°æ™‚ä¸€ç›¤ï¼‰
  - **é€²éšæ¨¡å¼**ï¼šä¹å®®æ‹†è£œï¼ˆ13åˆ†é˜æ³•ï¼‰ï¼Œæ¯æ™‚è¾°ç´°åˆ†ç‚º9æ®µ

### ğŸ¤– AI æ™ºèƒ½è§£ç›¤
- **AI å¤§å¸«è§£ç›¤**ï¼šä½¿ç”¨å¤§èªè¨€æ¨¡å‹é€²è¡Œæ™ºèƒ½è§£è®€
- **äº’å‹•å•ç­”**ï¼šé‡å°æ’ç›¤çµæœæå‡ºå…·é«”å•é¡Œ
- **å¤šæ¨¡å‹æ”¯æ´**ï¼šæ”¯æ´ OpenAIã€Claudeã€Groqã€é€šç¾©åƒå•ã€æœ¬åœ° Ollama ç­‰ [æ›´è©³ç´°èªªæ˜](LLM-INTEGRATION.md)
- **å€‹æ€§åŒ–åˆ†æ**ï¼šæ ¹æ“šä¸åŒç”¨é€”æä¾›å°ˆé–€å»ºè­°

### ğŸŒ å¤šèªè¨€æ”¯æ´
- **ç¹é«”ä¸­æ–‡**ï¼ˆé è¨­ï¼‰
- **ç°¡é«”ä¸­æ–‡**
- **èªè¨€åˆ‡æ›**ï¼šä¸€éµåˆ‡æ›ä»‹é¢èªè¨€

### ğŸ“Š å®Œæ•´ä¿¡æ¯å±•ç¤º
- **åŸºæœ¬è³‡è¨Š**ï¼šå±€æ•¸ï¼ˆé™°é™½éã€ä¸Šä¸­ä¸‹å…ƒï¼‰ã€å››æŸ±ã€æ—¬é¦–
- **ä¹å®®åˆ†æ**ï¼šå…«é–€ã€ä¹æ˜Ÿã€å…«ç¥åˆ†å¸ƒ
- **åœ°ç›¤è³‡è¨Š**ï¼šåœ°æ”¯ã€ä¸‰å¥‡å…­å„€
- **å€¼ç¬¦å€¼ä½¿**ï¼šè©³ç´°ä½ç½®å’Œå½±éŸ¿åˆ†æ
- **å‰å‡¶åˆ¤æ–·**ï¼šå„å®®ä½å‰å‡¶æ¨™è¨˜å’Œè©³ç´°èªªæ˜

### ğŸ¨ ç”¨æˆ¶é«”é©—
- **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šé©é…æ¡Œé¢å’Œæ‰‹æ©Ÿè¨­å‚™
- **ç›´è§€ç•Œé¢**ï¼šåœ–å½¢åŒ–ä¹å®®æ ¼é¡¯ç¤º
- **é¡è‰²æ¨™è¨˜**ï¼šäº”è¡Œé¡è‰²å’Œå‰å‡¶æ¨™ç¤º
- **è©³ç´°èªªæ˜**ï¼šåŒ…å«å¥‡é–€éç”²åŸºç¤çŸ¥è­˜

## å®‰è£ä½¿ç”¨

### ç’°å¢ƒè¦æ±‚
- Node.js 14+ 
- pnpm æˆ– npm

### å¿«é€Ÿé–‹å§‹
```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd qimen

# å®‰è£ä¾è³´
pnpm install

# é…ç½®ç’°å¢ƒè®Šæ•¸ï¼ˆå¯é¸ï¼Œç”¨æ–¼ AI åŠŸèƒ½ï¼‰
cp .env.example .env
# ç·¨è¼¯ .env æ–‡ä»¶ï¼Œè¨­ç½® LLM API Key

# å•Ÿå‹•æ‡‰ç”¨
pnpm start
# æˆ–
node app.js

# è¨ªå•æ‡‰ç”¨
# æ‰“é–‹ç€è¦½å™¨è¨ªå• http://localhost:3000
```

### AI åŠŸèƒ½é…ç½®

#### OpenAI é…ç½®
```env
LLM_PROVIDER=openai
LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=gpt-4o-mini
```

#### æœ¬åœ° Ollama é…ç½®ï¼ˆå…è²»ï¼‰
```env
LLM_PROVIDER=ollama
LLM_API_KEY=not_required
LLM_MODEL=llama3.1:latest
LLM_BASE_URL=http://localhost:11434/v1
```

#### Groq é…ç½®ï¼ˆé«˜é€Ÿæ¨ç†ï¼‰

```env
LLM_PROVIDER=groq
LLM_API_KEY=gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=mixtral-8x7b-32768
```

## æŠ€è¡“æ¶æ§‹

### å¾Œç«¯æŠ€è¡“
- **Express.js**ï¼šWeb æ¡†æ¶
- **lunar-javascript**ï¼šè¾²æ›†å’Œç¯€æ°£è¨ˆç®—
- **EJS**ï¼šæ¨¡æ¿å¼•æ“
- **å¤šèªè¨€æ”¯æ´**ï¼šè‡ªå»º i18n ç³»çµ±

### AI æ•´åˆ
- **LLM æœå‹™**ï¼šçµ±ä¸€çš„å¤šæä¾›å•†æ¥å£
- **æ™ºèƒ½æç¤ºè©**ï¼šçµæ§‹åŒ–å¥‡é–€æ•¸æ“šè½‰æ›
- **éŒ¯èª¤è™•ç†**ï¼šå„ªé›…é™ç´šå’Œå‚™ç”¨åˆ†æ

### å‰ç«¯æŠ€è¡“
- **Bootstrap**ï¼šéŸ¿æ‡‰å¼ UI æ¡†æ¶
- **jQuery**ï¼šDOM æ“ä½œå’Œ AJAX
- **CSS3**ï¼šç¾ä»£æ¨£å¼å’Œå‹•ç•«

## API æ¥å£

- `GET /`ï¼šä¸»é é¢ï¼ˆå¯¦æ™‚æ’ç›¤ï¼‰
- `GET /custom`ï¼šè‡ªå®šç¾©æ’ç›¤
- `POST /api/llm-analysis`ï¼šAI è§£ç›¤åˆ†æ
- `GET /api/llm-config`ï¼šLLM é…ç½®ç‹€æ…‹
- `GET /api/llm-test`ï¼šæ¸¬è©¦ LLM é€£æ¥

## å°ˆæ¡ˆçµæ§‹

```
qimen/
â”œâ”€â”€ app.js                 # ä¸»æ‡‰ç”¨ç¨‹åº
â”œâ”€â”€ lib/                   # æ ¸å¿ƒåº«
â”‚   â”œâ”€â”€ qimen.js          # å¥‡é–€éç”²è¨ˆç®—å¼•æ“
â”‚   â”œâ”€â”€ llm-analysis.js   # AI è§£ç›¤æœå‹™
â”‚   â”œâ”€â”€ i18n.js           # å¤šèªè¨€ç³»çµ±
â”‚   â””â”€â”€ constants.js      # å¸¸é‡å®šç¾©
â”œâ”€â”€ views/                 # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ public/               # éœæ…‹è³‡æº
â”œâ”€â”€ lang/                 # èªè¨€æ–‡ä»¶
â””â”€â”€ docs/                 # æ–‡æª”
```

---

# Qimen Dunjia Divination System

A Node.js-based Qimen Dunjia divination system following the Maoshan school methodology, with Traditional/Simplified Chinese support and AI-powered analysis.

**Credits**: This project is developed based on [qfdk/qimen](https://github.com/qfdk/qimen).

## Features

### ğŸ”® Core Functions
- **Real-time Divination**: Automatic calculation based on current time
- **Custom Divination**: Choose any date and time for divination
- **Multiple Methods**: Support for Shijia, Rijia, Yuejia, Nianjia Qimen
- **Multi-purpose Analysis**: General, career, wealth, love, health consultations

### ğŸ¤– AI-Powered Analysis
- **AI Master Reading**: Intelligent interpretation using Large Language Models
- **Interactive Q&A**: Ask specific questions about divination results
- **Multiple AI Models**: Support for OpenAI, Claude, Groq, Qwen, local Ollama
- **Personalized Analysis**: Tailored advice for different purposes

### ğŸŒ Multi-language Support
- **Traditional Chinese** (default)
- **Simplified Chinese**
- **Language Toggle**: One-click interface switching

### ğŸ“Š Comprehensive Display
- **Basic Info**: Bureau numbers, Four Pillars, Xun Shou
- **Nine Palaces**: Eight Gates, Nine Stars, Eight Spirits distribution
- **Earth Plate**: Earthly Branches, Three Wonders and Six Instruments
- **Zhifu Zhishi**: Detailed position and influence analysis
- **Fortune Assessment**: Palace-wise fortune marking and explanations

### ğŸ¨ User Experience
- **Responsive Design**: Desktop and mobile compatibility
- **Intuitive Interface**: Graphical nine-palace grid display
- **Color Coding**: Five-element colors and fortune indicators
- **Detailed Guide**: Qimen Dunjia fundamentals included

## Installation

### Requirements
- Node.js 14+
- pnpm or npm

### Quick Start
```bash
# Clone the project
git clone <repository-url>
cd qimen

# Install dependencies
pnpm install

# Configure environment (optional, for AI features)
cp .env.example .env
# Edit .env file to set LLM API Key

# Start the application
pnpm start
# or
node app.js

# Access the application
# Open browser and visit http://localhost:3000
```

### AI Configuration

#### OpenAI Setup
```env
LLM_PROVIDER=openai
LLM_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=gpt-4o-mini
```

#### Local Ollama Setup (Free)
```env
LLM_PROVIDER=ollama
LLM_API_KEY=not_required
LLM_MODEL=llama3.1:latest
LLM_BASE_URL=http://localhost:11434/v1
```

#### Groq Setup (High-speed Inference)

```env
LLM_PROVIDER=groq
LLM_API_KEY=gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LLM_MODEL=mixtral-8x7b-32768
```

## Technical Stack

### Backend
- **Express.js**: Web framework
- **lunar-javascript**: Lunar calendar and solar terms calculation
- **EJS**: Template engine
- **i18n System**: Custom multilingual support

### AI Integration
- **LLM Service**: Unified multi-provider interface
- **Smart Prompts**: Structured Qimen data conversion
- **Error Handling**: Graceful fallback and backup analysis

### Frontend
- **Bootstrap**: Responsive UI framework
- **jQuery**: DOM manipulation and AJAX
- **CSS3**: Modern styling and animations

## API Endpoints

- `GET /`: Main page (real-time divination)
- `GET /custom`: Custom divination
- `POST /api/llm-analysis`: AI divination analysis
- `GET /api/llm-config`: LLM configuration status
- `GET /api/llm-test`: Test LLM connection

## Project Structure

```
qimen/
â”œâ”€â”€ app.js                 # Main application
â”œâ”€â”€ lib/                   # Core libraries
â”‚   â”œâ”€â”€ qimen.js          # Qimen calculation engine
â”‚   â”œâ”€â”€ llm-analysis.js   # AI analysis service
â”‚   â”œâ”€â”€ i18n.js           # Multilingual system
â”‚   â””â”€â”€ constants.js      # Constants definition
â”œâ”€â”€ views/                 # Template files
â”œâ”€â”€ public/               # Static assets
â”œâ”€â”€ lang/                 # Language files
â””â”€â”€ docs/                 # Documentation
```

